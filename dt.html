<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <script src="head.js" defer></script>
</head>

<body onload="main()">


<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand text-center" href="#" style="width: 300px;"><span id="titulo"></span></a>
    <div class="collapse navbar-collapse">
        <ul class="navbar-nav bg-dark" id="menu"></ul>
        <ul class="navbar-nav ms-auto"> <!-- Clase ms-auto para empujar hacia la derecha -->
            <li class="nav-item">
                <span class="nav-link text-light" id="usuarioNombre">rttrtrtr</span> <!-- Aquí se mostrará el nombre del usuario -->
            </li>
            <li class="nav-item">
                <a class="nav-link btn btn-danger btn-sm" href="apiCustom/borrarSesion.php">Cerrar Sesión</a>
            </li>
        </ul>
    </div>
</nav>

  <div id="app">
    <div class="hidden container-fluid d-flex justify-content-center align-items-center vh-100">
     <div id="report-container" class="container-fluid h-100">
      <div class="row h-100">
        <div class="col-2" style="padding-top: 24px;">
          <h3>Seleccione las opciones</h3>
          <div id="filtrosPadres">
          </div>
          <hr>
          <div id="filtrosInternos">
            <div id="v_aaa_fechaInicial" data-interno="true">
              <label>Fecha Inicial</label>
              <input type="date" class="form-control arg" id="fechaInicial" onchange="cargarDatos();" onblur="cargarDatos();"/>
            </div>
            <div id="v_aaa_fechaFinal" data-interno="true">
              <label>Fecha Final</label>
              <input type="date" class="form-control arg" id="fechaFinal" onchange="cargarDatos();" onblur="cargarDatos();"/>
            </div>
            <div id="v_aaa_palabra" data-interno="true">
              <label>Buscar por palabras</label>
              <input type="text" class="form-control arg" id="palabra" onchange="cargarDatos();" onblur="cargarDatos();"/>
            </div>
            <div id="v_aaa_excepto" data-interno="true">
              <label>Excepto</label>
              <input type="text" class="form-control arg" id="excepto" onchange="cargarDatos();" onblur="cargarDatos();"/>
            </div>
            <hr>
            <textarea id="csv" style="display: none;"></textarea>
          </div>
        </div>
        <div class="col-10" id="salida" style="padding-top: 24px;">
          <div class="row">
            <div class="col col-3">
             <a href="#" id="copiarCSV" class="btn btn-success btn-sm">Exportar CSV</a>
             <a href="#" id="crearRegistroBtn" class="btn btn-success btn-sm">Crear Nuevo Registro</a>
           </div>
           <div class="col-6" id="botonesEspeciales">
          </div>
        </div>
        <div class="row">
          <table class="table display table-hover table-sm" id="tabla" style="margin-top: 24px;">
            <thead id="tabla-header"></thead>
            <tbody id="tabla-body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
</div>


<!-- Modal para mostrar detalles del registro -->
<div class="modal fade" id="modalDetalles" tabindex="-1" aria-labelledby="modalDetallesLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalDetallesLabel">Detalles del Registro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modalDetallesBody">
        <!-- Aquí se llenará la información del registro -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal para confirmar la eliminación del registro -->
<div class="modal fade" id="modalConfirmacion" tabindex="-1" aria-labelledby="modalConfirmacionLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalConfirmacionLabel">Confirmar Eliminación</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modalConfirmacionBody">
        <!-- Aquí se llenará la información del registro -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger" id="btnConfirmarEliminar">Eliminar</button>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="funciones.js"></script>
<script type="text/javascript" src="dt.js"></script>

<script>
  main();
  async function main() {
    console.log("----------------------------------------------------------------------------------");
    const urlParams = new URLSearchParams(window.location.search);
    var vista = urlParams.get('v');


    const alias = await cargarYAML('YAML_alias'); 
    //alias=JSON.parse(alias);
    console.log("ALIAS:",alias)
    const yaml_datatables = await cargarYAML('YAML_datatables'); 

    const yaml_funcionesGenerales = await cargarYAML('YAML_funcionesGenerales'); 
    var yaml_menu = await cargarYAML('YAML_menu'); 
    yaml_menu = yaml_menu.root;
    console.log(yaml_menu);


    const session = await datosUsuario();
    const nivel=session.id_perfil_usuario;
    document.getElementById('usuarioNombre').innerHTML="USUARIO: "+session.usuario;
    document.getElementById('crearRegistroBtn').href = `crearRegistro.html?v=${vista}`; 
    document.getElementById('titulo').innerHTML=alias[vista]; 
    crearMenu(yaml_menu[nivel], session); 
    const yaml_filtrosPadres = await cargarYAML('YAML_filtrosPadres'); 
    var filtrospadres = await crearFiltrosPadres(vista, yaml_filtrosPadres.root[vista]);
    var valoresDefecto = await getValoresDefecto('dt',vista);
    console.log("MAIN VALORES DEFECTO: ",valoresDefecto);

    var campos=yaml_datatables.root[vista].campos;
    var argumentos={ vista:vista }
    var fp = await cargarFiltrosPadres();
    mostrarFiltrosPadres(yaml_filtrosPadres.root[vista],argumentos);  
    //botonesEspeciales(vista);

    modificar(argumentos,'dt'); //agrega el onchange en todos los controles
    restaurarInput(valoresDefecto);
    var datos= await cargarDatos();
    //inicializarTabla(); // Luego inicializas la DataTable

    //valoresDefecto = await setValoresDefecto('dt',vista);
    console.log("MAIN VALORES DEFECTO ACTUALIZADOS: ", valoresDefecto);
    /*
    */
  }



</script>
</html>
